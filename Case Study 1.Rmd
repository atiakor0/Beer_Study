---
title: "Case Study 1"
author: "Allen Ansari,Audrene Tiakor"
date: "February 17, 2019"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
setwd("E:/University/Doing Data Science/Unit 7/Beer_Study")
```


```{r message=FALSE, warning=FALSE, , include=TRUE, paged.print=FALSE}
library(ggplot2) # Data visualization
library(readr) # CSV file I/O, e.g. the read_csv function
library(dplyr) # Heavy use of this library
library(tidyr)
library(plyr)
library(ggthemes) # for themes in ggplot
library(knitr)
library(kableExtra) # library to make the document more presentable
library(Amelia) # for missing map
library(datasets) # to make region col
library(zoo)
```

```{r}
# Read in beer and breweries data set using _csv for more tidy output
Beers <- read_csv('Beers.csv', col_types = cols())
Breweries <- read_csv('Breweries.csv', col_types = cols())
```

### 1. How many breweries are present in each state?

To answer this question we used table function to  retrieve the value of `State` from the `Breweries` data.
```{r}
BrewPerState <-table(Breweries$State)
BrewPerState

```
### 2. Merge beer data with the breweries data. Print the first 6 observations and the last six observations to check the merged file.
We can merge them into a single dataset, using `full_join` unisng Brewery_id from Beers dataset and Brew_ID from Breweries dataset.
```{r}
BrewPub <- merge(Beers, Breweries, by.x = "Brewery_id", by.y = "Brew_ID", all = TRUE)
# Change variable names to more meaningful title

BrewPub <- rename(BrewPub, c("Name.x"="Beer","Name.y"="Brewery",
                   "Ounces"="OZ"))
# Used kable library to make document more presentable
kable(BrewPub %>% 
         head()) %>%
         kable_styling("striped", full_width = F)
        

kable(BrewPub %>% 
         tail()) %>%
         kable_styling("striped", full_width = F) 
         

```

### 3. Report the number of NA's in each column.


To do this, we use a function (which returns `true` if a given value is NA, `false` otherwise, using `is.na`) and `sapply` to determine the number of missing values for each column within `BrewPub`.

Per the results, we find that there are a total of 62 ABV values missing, 1005 IBU values amd 5 Style values missing. No other data is missing.
```{r}
MissingValues <- sapply(BrewPub,function(MissingValue)sum(is.na(MissingValue)))

# Used kable library to make document more presentable
as.data.frame(MissingValues) %>%
  kable("html") %>%
  kable_styling("striped", full_width = F) 

missmap(BrewPub,y.at=c(1),y.labels = c(''),col=c('yellow','black'))
  

```

### 4. Compute the median alcohol content and international bitterness unit for each state. Plot a bar chart to compare.

```{r}
# 4. Compute the median alcohol content unit for each state.
Alc <- BrewPub %>%
  na.omit()  %>%
group_by(State) %>%
summarise_each(funs(median), Median_ABV = ABV) %>%
arrange(Median_ABV)
Alc
```

```{r}
# 4. a Compute the median international bitterness unit for each state.
Bitter <- BrewPub %>%
  na.omit() %>%
group_by(State) %>%
summarise_each(funs(median), Median_IBU = IBU) %>%
arrange(Median_IBU)
Bitter
```

```{r}
# 4. b Plot a bar chart to compare ABV by state

ggplot(data=Alc, aes(x=State, y=sort(Median_ABV,decreasing = TRUE))) +
  geom_bar(stat="identity", fill="red")+
  theme_bw() + 
  scale_color_economist()+
  theme(axis.text.x=element_text(size=rel(0.8), angle=90),plot.title = element_text(size=14,hjust = 0.5, face="bold.italic")) +
  ggtitle("Median ABV by State") +
  labs(x="State",y="ABV")

```


```{r}
# 4. c Plot a bar chart to compare IBU by state
ggplot(data=Bitter, aes(x=State, y=Median_IBU)) +
  geom_bar(stat="identity", fill="steelblue")+
  theme_bw() + 
  scale_color_economist()+
  theme(axis.text.x=element_text(size=7, angle=90),plot.title = element_text(size=14,hjust = 0.5, face="bold.italic"))+ ggtitle("Median IBU by State") + labs(x="State",y="IBU")

```

## 5- Which state has the maximum alcoholic (ABV) beer? Which state has the most bitter (IBU) beer?

``` {r}
# finding state which has has the maximum alcoholic (ABV) beer
Max_ABV <- Alc[which.max(Alc$Median_ABV),]
Max_ABV
# finding state which has has the maximum alcoholic (IBU) beer
Max_IBU <- Bitter[which.max(Bitter$Median_IBU),]
Max_IBU

``` 
## 6- Summary statistics for the ABV variable
To do this, we apply the function summary() to the variable ABV (alcohol content of our data set 'BrewPub'), which returns descriptive statistics of ABV such as the minimum value (smallest value of ABV), the first quartile, the median, the mean, the thrid quartile, and the maximum (largest value of ABV).
``` {r}
# summary statistics for the ABV variable
summary(BrewPub$ABV)
``` 

## 7- Is there an apparent relationship between the bitterness of the beer and its alcoholic content?
``` {r}
# drawing a Scatter plot Bitterness of Beer vs Alcholic content
ggplot(BrewPub, aes(x=BrewPub$IBU, y=BrewPub$ABV)) + geom_point() + geom_smooth(method=lm, se=FALSE) + theme(plot.title = element_text(size=14,hjust= 0.5, face="bold.italic")) + ggtitle("Relationship Between Bitterness of Beer and Its Alcoholic Content") +
  labs(x="Bitterness",y="Alcoholic Content") 

``` 
After plotting a scatter plot to depict the relationship between the bitterness of the beer and its alcoholic content, we can see that there is a positive correlation between the bitterness of the beer and its alcoholic content. The higher the alcohol content, the more bitter the beer will taste. With this information an ANOVA for the relationship between IBU and ABV can be conducted. If we can conclude that this model is significant, then a linear regression model can be found with its respective linear regression equation to quanitfy the relationship between IBU and ABV, also enabling the option to predict ABV for IBU that we don't have but would like to explore. 

### Regression Line for relationship between IBU and ABV

``` {r}
# Compute ANOVA for ABV and IBU
reg1 <- lm(ABV ~ IBU, data = BrewPub)
# Summary of reg 1
summary(reg1)
```
Here we have a p-value of 2e^-16, so at the alpha= 0.05 level we find that there is strong evidence that there is a relationship between IBU and ABV. To quantify this relationship, a linear regression model will be graphed, with its respective equation.
``` {r}
# Create a function to pull the data out of a linear regression, return values such as  (R-squares, slope, intercept and P value) at the top of a nice ggplot graph with the regression line.
Regressionplot <- function (reg) {
 
require(ggplot2)

 ggplot(reg$model, aes_string(x = names(reg$model)[2], y = names(reg$model)[1])) + geom_point() + stat_smooth(method = "lm", col = "red") + labs(title = paste("Adj R2 = ",signif(summary(reg)$adj.r.squared, 5), "Intercept =",signif(reg$coef[[1]],5 ), " Slope =",signif(reg$coef[[2]], 5), " P =",signif(summary(reg)$coef[2,4], 5)))
}

#Final regression plot with R^2 adj, intercept/slope of linear regression line, and p-value
Regressionplot(reg1)
```

## Further Analysis of Data (By Region)
After using the visual evidence of the scatter plot of the relationship between IBU and ACV, further analysis was used to look at the IBU and ACV of regions. The states were taken and split into the following regions: South, West, Northeast, and North Central . After each state was separated into their respective regions, Explanatory Data Analysis and ANOVA was used to see if there was any significant results between IBU and ACV of each region.

``` {r}
# Creating Region Col
StateAbb <- as.data.frame(state.abb) # usnig stat.abb dataset 
StateRegion <- as.data.frame(state.region) # using state.region dataset
# Combine 2 datasets
State <- cbind(StateAbb,StateRegion)
names(State) <- c("State" , "Region")
# Merge State by BrewPub
BrewRegion <- merge(BrewPub,State, by="State")

# Replacing IBU Missing Value by Region mean
BrewRegion[is.na(BrewRegion$IBU), "IBU"] <- tapply(BrewRegion$IBU, BrewRegion$Region, mean,na.rm=TRUE)[ BrewRegion[is.na(BrewRegion$IBU),"Region"]] 

# Replacing ABV Missing Value by Region mean
BrewRegion[is.na(BrewRegion$ABV), "ABV"] <- tapply(BrewRegion$ABV, BrewRegion$Region, mean,na.rm=TRUE)[ BrewRegion[is.na(BrewRegion$ABV),"Region"]] 

# Missing Map after replacing NAs by mean

missmap(BrewRegion,y.at=c(1),y.labels = c(''),col=c('yellow','black'))

```


``` {r}
# Histogram of ABV
ABV_Hist <- ggplot(BrewRegion,aes(x=ABV)) + geom_histogram(aes(fill=Region)) +theme(axis.text.x=element_text(size=7), plot.title = element_text(size=14,hjust = 0.5, face="bold.italic"))+ ggtitle("Histogram of Alcohol Content By Region") + labs(x="ABV",y="Count")
ABV_Hist

# Histogram of IBU
IBU_Hist <- ggplot(BrewRegion,aes(x=IBU)) + geom_histogram(aes(fill=Region)) +theme(axis.text.x=element_text(size=7), plot.title = element_text(size=14,hjust = 0.5, face="bold.italic"))+ ggtitle("Histogram of Beer Bitterness By Region") + labs(x="IBU",y="Count")
ABV_Hist

# Boxplot of Alcohol Content By Region
ABV_Box<-ggplot((BrewRegion), aes(x = Region, y = ABV)) + geom_boxplot() + theme(axis.text.x=element_text(size=7, angle=90), plot.title = element_text(size=14,hjust = 0.5, face="bold.italic"))+ ggtitle("Boxplot of Alcohol Content By Region") + labs(x="Region",y="ABV")
ABV_Box

# Boxplot of Beer Bitterness By Region
IBU_Box<- ggplot((BrewRegion), aes(x = Region, y = IBU)) + geom_boxplot() + theme(axis.text.x=element_text(size=7, angle=90), plot.title = element_text(size=14,hjust = 0.5, face="bold.italic"))+ ggtitle("Boxplot of Beer Bitterness By Region") + labs(x="Region",y="IBU")
IBU_Box

# ABV per Region Bar Plot
ggplot(BrewRegion, aes(x=Region, y=ABV)) +
  geom_bar(stat="identity", fill="red")+
  theme_bw() + 
  scale_color_economist()+
  theme(axis.text.x=element_text(size=rel(0.8), angle=90),plot.title = element_text(size=14,hjust = 0.5, face="bold.italic")) +
  ggtitle("ABV by Region") +
  labs(x="Region",y="ABV")

# IBU per Region Bar plot
ggplot(BrewRegion, aes(x=Region, y=IBU)) +
  geom_bar(stat="identity", fill="red")+
  theme_bw() + 
  scale_color_economist()+
  theme(axis.text.x=element_text(size=rel(0.8), angle=90),plot.title = element_text(size=14,hjust = 0.5, face="bold.italic")) +
  ggtitle("IBU by Region") +
  labs(x="Region",y="IBU")

#  Plot a bar chart to compare Median of ABV by Region

BrewRegion %>%   na.omit() %>%
group_by(Region) %>%
summarise_each(funs(median), Median_ABV = ABV) %>% ggplot(aes(x=Region, y=sort(Median_ABV,decreasing = TRUE))) +
  geom_bar(stat="identity", fill="red")+
  theme_bw() + 
  scale_color_economist()+
  theme(axis.text.x=element_text(size=rel(0.8), angle=90),plot.title = element_text(size=14,hjust = 0.5, face="bold.italic")) +
  ggtitle("Median ABV by Region") +
  labs(x="Region",y="ABV")

#  Plot a bar chart to compare Median of IBU by Region

BrewRegion %>%   na.omit() %>%
group_by(Region) %>%
summarise_each(funs(median), Median_IBU = IBU) %>% ggplot(aes(x=Region, y=sort(Median_IBU,decreasing = TRUE))) +
  geom_bar(stat="identity", fill="red")+
  theme_bw() + 
  scale_color_economist()+
  theme(axis.text.x=element_text(size=rel(0.8), angle=90),plot.title = element_text(size=14,hjust = 0.5, face="bold.italic")) +
  ggtitle("Median IBU by Region") +
  labs(x="Region",y="IBU")

```

### Analysis Of Variance
``` {r}
# Compute the analysis of variance for ABV mean
BeerABV.aov <- aov(ABV ~ Region, data = BrewRegion)
# Summary of the analysis
summary(BeerABV.aov)

# There is strong evidence showing that at confidence level of 0.05 the mean of ABV in each region are different (P-Value = 0.02) 

# Compute the analysis of variance for IBU mean
BeerIBU.aov <- aov(IBU ~ Region, data = BrewRegion)
# Summary of the analysis
summary(BeerIBU.aov)

# There is strong evidence showing that at confidence level of 0.05 the mean of IBU in each region are different (P-Value < 0.0001) 

```
